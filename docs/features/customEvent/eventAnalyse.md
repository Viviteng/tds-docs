---
title: 事件分析
sidebar_position: 3
---

> English manual coming soon, we apologize for the temporary inconvenience.

## 一、概述

用户（设备/账号）在 APP内 产生的行为称为事件（EVENT），值得强调的是， `TapDB` 将“用户”的概念一分为二，即设备或者账号，设备即用户所使用的手机/平板/pc等等，账号即SDK通过setuser埋点所上传至 `TapDB` 的userid，该概念贯穿整个 `TapDB 2.0`。客户可以通过切换查询主体来定义当前查询的是账号还是设备的数据。点击设备/账号之后要点击查询按钮方可生效。

![概述](/img/customEvent/event_analyse_overview.png)

在 `TapDB 1.0` 中，所查询的指标与维度基本都是写死的，比如arpu，LTV等等。现在所推出的2.0版本旨在帮助客户统计偏自定义的事件，需要客户通过SDK上传，从而拓宽数据的丰富程度。比如：

1. 进入中秋节副本的用户平均给年兽BOSS造成了多少伤害
2. 参加了春节抽卡活动的用户的后续付费金额有多少
3. 来自美国的用户在元旦活动中的通关率

## 二、 查询逻辑

![查询逻辑](/img/customEvent/event_analyse_query_logic.png)

### 2.1 顶部开关

顶部有3个开关，分别为查询主体（上文已解释），数据范围：包含/不包含自然用户，自然用户指非广告归因所带来的用户。近似计算，开启之后仅查询部分样本的数据。这三个开关切换之后均需要点击查询按钮才能生效。

### 2.2 选择指标

指标即“xx事件+该事件的属性+分析角度”。

![选择指标](/img/customEvent/event_analyse_select_indicator.png)


A：xx事件

B：默认查询的分析角度，任何事件都至少有这三个分析角度：总次数，触发用户数，人均次数。

C：该事件的属性

D：该事件属性所对应的分析角度。不同数值类型的属性所对应的分析角度也不同 。

数值类型 | 分析角度
--- | ---
数值型 | 总和、中位数，均值、最大值、最小值、人均值、去重数
列表型 | 列表去重数、列表元素去重数
布尔型 | 去重数、为真数、为假数、为空数、不为空数
非数值、布尔型 | 去重数


除上表列出的各数值类型的分析角度之外，任意事件任意数值类型都具备的默认分析角度为：总次数、触发用户数、人均次数。


**编辑公式：**

客户可使用现有指标经过一系列计算（计算而非查询）生成新的指标

- 填写指标名称：必填，不可重复
- 可对每个参与计算的事件单独设定对应的筛选条件，同一事件的多筛选条件间可取交集/并集。
![编辑公式](/img/customEvent/event_analyse_edit_formula_1.png)
- 可对整个自定义公式设定对应的筛选条件，多筛选条件间可取交集/并集。
![编辑公式](/img/customEvent/event_analyse_edit_formula_2.png)
- 可对自定义编辑的公式选择数学取值类型，分别为“两位小数”，“整数”，”百分比“
![编辑公式](/img/customEvent/event_analyse_edit_formula_3.png)


**构造公式举例：**

“xx事件+该事件的属性+分析角度”  四则运算  。比如：平均副本伤害=副本事件的副本伤害值的中位数 / 战斗事件的副本个数的最大值


### 2.3 选择维度

维度即选择数据的聚合方式。比如 ：

1. 以国家维度聚合查询用户的付费金额。
2. 以渠道包维度聚合查询用户打BOSS造成伤害值。

#### 2.3.1 维度的分类

事件属性、用户属性、用户分群


首先阐述事件属性和用户属性从业务场景上的使用：

 事件属性：描述事件发生时候的状态，比如：用户在美国充了多少钱？这里查询在美国（充钱的用户现在可能不在美国）发生的付费事件。

 用户属性：描述触发xx事件的用户的状态。比如：现在在美国的用户充了多少钱？这里查询现在在美国的用户（包含曾经不在美国）触发的付费事件。

其次阐述二者在数据逻辑上的区别：

 事件属性：即每一条事件所带的参数。比如通过SDK传“中秋节”事件，该事件带有3个属性，“中秋道具个数”，“粽子种类”，“用户购买龙舟数量”。在选择事件属性的维度时，可选的维度受到所选事件的约束，比如事件选定为“中秋节”的情况下，事件属性只能选择这3个。

 用户属性：即用户表里的字段。用户属性不受所选事件的约束。



当所选维度为数值类型的字段时，比如付费金额，会出现区间的选择，离散区间即按照该字段所具有的所有数值进行聚合查询，默认区间为系统按照某规则设定聚合区间，自定义区间为客户可以自己定义区间段来聚合数据。

![自己定义区间](/img/customEvent/event_analyse_custom_range.png)

当所选维度有“事件发生时间”时，可选择时间的颗粒度，支持按天，小时，分钟，周，月。

![时间颗粒度](/img/customEvent/event_analyse_time_granularity.png)


### 2.4 筛选器

![筛选器](/img/customEvent/event_analyse_global_filter.png)

#### 2.4.1 筛选数据类型

筛选的数据类型共有5种，分别对应支持不同的数学逻辑：

1. 数值。比如：充值金额。支持数学逻辑：等于、不等于、小于、大于、有值、无值、区间

2. 字符串。比如：事件发生的城市。支持数学逻辑：等于、不等于、包含、不包含、有值、无值、正则匹配

3. 列表ID。比如：名单。支持数学逻辑：存在元素、不存在元素、元素位置、有值、无值

4. 时间。比如：注册时间（yyyy-MM-dd HH:mm:ss.SSS 或 yyyy-MM-dd HH:mm:ss）。支持数学逻辑：绝对时间、相对当前时间、相对事件发生时刻、有值、无值

5. 布尔。比如：Wifi 使用。支持数学逻辑：为真、为假、有值、无值




## 2.4.2 等于/不等于和包含/不包含的区别

**等于/不等于：筛选项目中严格符合所选值才可被过滤，比如筛选条件：次大陆等于美洲，则仅查询美洲的数据。**

包含/不包含：筛选项目中包含所选值即可被过滤，比如次大陆包含美洲，则美洲，北美洲，南美洲的数据都可以被过滤出。

绝对时间：指客观的现实时间。比如2021-03-02 19:24:52至2021-03-08 19:24:52，前一时间必须在后一时间之前。点击“选择时间”可以精确到选择秒

![选择时间](/img/customEvent/event_analyse_time_filter.png)

相对当前时间：指相对现在来说，过去n天。

![相对时间](/img/customEvent/event_analyse_relative_time_1.png)

相对事件发生时刻：指相对所选的事件的前后n天。此处可选负数，比如-1天，则含义为所选事件发生之前的一天，如果所选为正数，比如1天，含义为所选事件发生之后的一天。

![相对时间](/img/customEvent/event_analyse_relative_time_2.png)


”且““或”逻辑：

可添加多个筛选条件。当筛选条件至少2个或以上时，会出现且/或切换按钮，默认是“且”。“且”即为多个筛选条件取交集，“或”为多个筛选条件取并集。

选择完筛选条件以后，点击查询按钮生效。


### 2.5 对比日期

对比日期与所选日期区间范围要保持一致，比如下图例子中，所选日期为2021-3-2到2021-3-8，间隔为6天，则对比日期间隔也为6天。在选择对比日期时，只需要选择一个日期（比如2021-02-23），系统会自动往后推算6天（至2021-03-01）。

![对比日期](/img/customEvent/event_analyse_time_compare.png)


### 2.6 保存报表

选择完主维度和指标后，点击保存报表将该报表保存下来，输入名字后点击确认，则该报表被保存至“已保存报表”中。

![保存报表](/img/customEvent/event_analyse_save_report_1.png)

首次保存某报表后，再次打开该报表即会出现“另存为”按钮，点击后另存为一张新的报表，若点击“保存报表”，则是更新之前保存的报表。

![保存报表](/img/customEvent/event_analyse_save_report_2.png)

被保存/另存为的报表展现在屏幕右侧“我的报表”，可以点击自己保存的报表直接查询。

![保存报表](/img/customEvent/event_analyse_save_report_3.png)


## 三、 透视表

**透视表是一种可交互的数据报表形态，其特点为所进行的计算与数据跟数据透视表中的排列有关。之所以称为数据透视表，是因为可动态改变数据的聚合维度的先后顺序，从而使得客户可以用多重角度观察数据。下面我们对比以下两张透视表：**

![透视表](/img/customEvent/event_analyse_pivot_table_1.png)

![透视表](/img/customEvent/event_analyse_pivot_table_2.png)

上下两张透视表（分别简称上表和下表，以下同）。

上表中，想要查询中国各省份当中，各设备系统及使用各网络运营商的用户的充值金额总和，即以“省份”视角透视拆分“设备系统”数据，进而又透视拆分“网络运营商”数据。

下表中，想要查询中国各网络运营商当中，各设备系统及各省份的用户的充值金额总和，即以“网络运营商”视角透视拆分“设备系统”数据，进而又透视拆分“省份”数据。


### 3.1 可拖拽

透视表的每一列均可以用鼠标拖拽从而改变顺序。其中，维度被拖拽改变前后顺序以后，数据重新进入查询，即如同上表下表改变了数据透视拆分的角度。指标被拖拽以后仅改变展示的顺序，不会重新进入查询。灵活运用拖拽可提高数据查询的效率。目前，透视表可最多勾选5个维度和20个指标。

### 3.2 搜索

透视表的维度表头处，可以点击搜索输入文字，快速筛选出符合条件的项目，这里为结果筛选，筛选后不会重新进入查询。

![表搜索](/img/customEvent/event_analyse_table_filter.png)

### 3.3 排序

透视表的默认排序逻辑：

首先，对第一列主维度对应的所要排序指标的总计数据做从大到小排序

进而，对第二列主维度对应的所要排序指标的总计数据做从大到小排序

以此类推

对第n列主维度对应的所要排序指标的总计数据做从大到小排序

        
排序举例：

![表排序](/img/customEvent/event_analyse_sortable.png)

在上图所示情况中，第一列所选主维度为广告平台，第二列为广告，第三列为商主。当用户对“成本”指标做排序时，排序逻辑如下：

- 首先比较第一列主维度（广告平台）中，今日头条与抖音KOL在“成本”指标的总计数据，分别为40000和15000 。因此今日头条排在抖音KOL之上。
- 进而比较第二列主维度（广告）中，在“今日头条”下，“抽卡”的成本总计为25000，“爆量”的成本总计为15000，因此抽卡排在爆量之上。
- 以此类推。
- 只有指标会出现排序按钮，维度没有排序按钮。
- 特殊情况：当所选的主维度为日期的时候，可以对日期做排序。

排序功能目前尚在开发。


### 3.4 下载数据

透视表右侧点击下载按钮，可下载平铺数据，下载结果为当前查询结果，可以实现所见即所得。提供CSV/PDF/图片三种格式。


![下载数据](/img/customEvent/event_analyse_download.png)

