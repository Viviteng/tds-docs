---
title: 留存分析
sidebar_position: 4
---

> English manual coming soon, we apologize for the temporary inconvenience.

## 一、概述

与 `TapDB` 老版本中留存的概念不同，2.0版本中将留存的概念进行了泛化。旨在帮助客户分析完成某项初始事件的用户中，在一段时间内会进而进行回访事件的人数和比例。比如有以下场景：

1. 完成登陆（初始事件）的用户中，有多少用户在接下来三个月进而完成了付费（回访事件）

2. 完成升级到vip 9 级（初始事件）的用户在接下来一个月购买了多少礼包（回访事件）


## 二、查询逻辑


### 2.1 留存分析页面概述

留存分析页面主要有查询主体，数据范围（此二者在事件分析中已描述，此处不再赘述），选择初始事件 ，回访事件，进而选择聚合数据的维度，查询逻辑为完成初始事件的用户中进而完成回访事件的用户数和占比。点击查询按钮生成报表。留存报表中，拿2021-03-04这一天的数据举例，指标的第一列为“当日”，这里查询的是在2021-03-04同时完成初始事件和回访事件的用户（不分先后顺序），接下来为第n日的留存，业务含义为，比如：第1日指的是2021-03-04完成了初始事件的用户中，在2021-03-05又完成了回访事件的用户数和占比。

![查询逻辑](/img/customEvent/retention_analyse_query_logic.png)


### 2.2 选择事件

分别选择初始事件以及回访事件，可以分别对其做筛选。值得注意的是，针对初始/回访的筛选项目中， 只允许选择事件属性，如果想要选择用户属性的过滤，可以在全局筛选中进行。

![选择事件](/img/customEvent/retention_analyse_select_event.png)


### 2.3 同时展示

设计该功能的主要目的是对触发回访事件的用户再次进行一次深入分析。比如：

我想统计完成登陆的用户中有多少用户完成了付费，并且，我还想统计这些完成付费的用户的充值总金额。

在这个例子中，就是对付费用户再做一次付费金额阶段累计总和的统计，可以使用同时展示功能来完成。

![同时展示](/img/customEvent/retention_analyse_display_sametime.png)

与事件分析模版不同，同时展示功能中，针对数值类型的属性，分析角度由“总和、中位数，均值、最大值、最小值、人均值、去重数”变为了“总和、人均值、阶段累计总和、阶段累计人均”。而且，此处仅可选数值类型和布尔类型的属性，不能选时间，字符串，列表类型的属性，因为这些类型的属性不能统计“阶段累计”。利用同时展示功能，客户可以分析完成回访事件的用户在接下来一段时间的某某属性值的阶段累计总和/人均，比如LTV，n日付费，累计副本伤害值，累计人均购买礼包数等等。

指标描述/数据类型 | 分析角度
--- | ---
数值型 | 总和、人均值、阶段累计总和、阶段累计人均
布尔型 | 为真数、为假数、为空数、不为空数

**除上表列出的各数值类型的分析角度之外，任意事件任意数值类型都具备的默认分析角度为：总次数、触发用户数、人均次数。**

“阶段累计”是同时展示功能的核心价值体现。同时展示最多只能做一项分析。


### 2.4 选择维度

与事件分析中不同，留存分析模版中“事件发生时间”为必选维度，原因是留存天然与时间关联。除了时间维度外，还可额外再选最多5个维度。

![同时展示](/img/customEvent/retention_analyse_select_dimension.png)


## 三、报表

留存分析的报表依然是透视表形态，与事件分析报表不同的是，“事件发生时间”这一个维度是不能拖拽改变先后聚合顺序的，只能在第一列。

![报表](/img/customEvent/retention_analyse_table.png)

时间选择器与对比日期在事件分析中已有描述。


### 3.1 选择留存的分析期限

![分析期限](/img/customEvent/retention_analyse_date_range.png)

留存的分析期限默认为7日。点击之后下拉框可选：

当日，次日，7日，14日，30日，当周，次周，4周，8周，16周，当月，次月，3月，6月，12月

除上述时间以外，客户也可以自己手动填写n日，n周，n月。

由于如果所选留存的分析期限过长，比如选了180天，会因为数据量过大导致计算缓慢，而客户不一定非要看180天中每一天的留存情况，此时可以使用“仅显示关键日期”，

日的关键日期为：1，7，14，21，30，60，90，120，150，180，360日

周的关键日期为：1，4，8，16，24，32，40，48，52周

月的关键日期为：1，3，6，12，24月

勾选“仅显示关键日期”后，仅查询上述时间点的留存情况，从而可以缩短查询时间。当所选留存期限大于90天时，系统自动勾选“仅显示关键日期”，不过此时依然允许客户取消勾选。


### 3.2 留存/流失

![分析期限](/img/customEvent/retention_analyse_retention_loss.png)

n日留存的判断逻辑：在x月x日触发了初始事件的用户有x人在第n日触发了回访事件，“留存百分比”即为x/n。

n日流失的判断逻辑：在x月x日触发了“初始事件”的用户，在之后的第 1 日至第 N 日（持续时间）有x人都未触发“回访事件”，x即为第 N 日的“流失用户”数量。“流失百分比”即为x/n。


### 3.3 显示数量/百分比

报表右侧可选择显示全部/仅显示百分比/仅显示数量

![表显示](/img/customEvent/retention_analyse_dispaly_mode.png)
